<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ÊäïÁ•®„Ç∑„Çπ„ÉÜ„É†</title>
        <style>
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                max-width: 1000px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .container {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }
            h1 {
                color: #333;
                text-align: center;
                margin-bottom: 30px;
            }
            .mode-selector {
                text-align: center;
                margin-bottom: 30px;
            }
            .mode-btn {
                background: #007bff;
                color: white;
                padding: 12px 30px;
                border: none;
                border-radius: 5px;
                font-size: 16px;
                cursor: pointer;
                margin: 0 10px;
                transition: background 0.2s;
            }
            .mode-btn:hover {
                background: #0056b3;
            }
            .mode-btn.active {
                background: #28a745;
            }
            .admin-login {
                background: #fff3cd;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
                border: 1px solid #ffeaa7;
            }
            .admin-login input {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 16px;
                margin: 10px 0;
            }
            .question {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
                border-left: 4px solid #007bff;
            }
            .question h3 {
                margin-top: 0;
                color: #333;
            }
            .options {
                margin: 15px 0;
            }
            .option {
                margin: 10px 0;
                padding: 10px;
                background: white;
                border-radius: 5px;
                border: 2px solid #e9ecef;
                cursor: pointer;
                transition: all 0.2s;
                position: relative;
            }
            .option:hover {
                border-color: #007bff;
                background: #f8f9ff;
            }
            .option input[type="radio"] {
                margin-right: 10px;
            }
            .correct-answer {
                border-color: #28a745;
                background: #f8fff8;
            }
            .correct-indicator {
                position: absolute;
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
                color: #28a745;
                font-weight: bold;
            }
            .voter-info {
                background: #e7f3ff;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
            }
            .voter-info input {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 16px;
            }
            button {
                background: #007bff;
                color: white;
                padding: 12px 30px;
                border: none;
                border-radius: 5px;
                font-size: 16px;
                cursor: pointer;
                transition: background 0.2s;
                margin: 5px;
            }
            button:hover {
                background: #0056b3;
            }
            button:disabled {
                background: #6c757d;
                cursor: not-allowed;
            }
            .btn-success {
                background: #28a745;
            }
            .btn-success:hover {
                background: #1e7e34;
            }
            .btn-danger {
                background: #dc3545;
            }
            .btn-danger:hover {
                background: #c82333;
            }
            .btn-warning {
                background: #ffc107;
                color: #212529;
            }
            .btn-warning:hover {
                background: #e0a800;
            }
            .results {
                margin-top: 30px;
                display: none;
            }
            .result-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                margin: 5px 0;
                background: #f8f9fa;
                border-radius: 5px;
            }
            .result-bar {
                background: #007bff;
                height: 20px;
                border-radius: 10px;
                margin: 5px 0;
                transition: width 0.5s ease;
            }
            .message {
                padding: 15px;
                border-radius: 5px;
                margin: 10px 0;
                display: none;
            }
            .success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .admin-panel {
                display: none;
            }
            .question-form {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
            }
            .question-form input,
            .question-form textarea {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 14px;
                margin: 5px 0;
            }
            .question-form textarea {
                height: 80px;
                resize: vertical;
            }
            .option-input {
                display: flex;
                align-items: center;
                margin: 5px 0;
            }
            .option-input input[type="text"] {
                flex: 1;
                margin-right: 10px;
            }
            .option-input input[type="radio"] {
                margin-right: 5px;
            }
            .question-list {
                max-height: 400px;
                overflow-y: auto;
            }
            .question-item {
                background: white;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 10px;
                border: 1px solid #ddd;
            }
            .question-item.active {
                border-color: #28a745;
                background: #f8fff8;
            }
            .question-item.inactive {
                border-color: #dc3545;
                background: #fff5f5;
            }
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }
            .stat-card {
                background: white;
                padding: 20px;
                border-radius: 8px;
                border: 1px solid #ddd;
            }
            .stat-number {
                font-size: 2em;
                font-weight: bold;
                color: #007bff;
            }
            .hidden {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üó≥Ô∏è ÊäïÁ•®„Ç∑„Çπ„ÉÜ„É†</h1>

            <div class="mode-selector">
                <button class="mode-btn active" onclick="switchMode('vote')">ÊäïÁ•®</button>
                <button class="mode-btn" onclick="switchMode('admin')">ÁÆ°ÁêÜËÄÖ</button>
            </div>

            <!-- ÊäïÁ•®ËÄÖ„É¢„Éº„Éâ -->
            <div id="vote-mode">
                <div class="voter-info">
                    <h3>üë§ ÊäïÁ•®ËÄÖÊÉÖÂ†±</h3>
                    <input type="text" id="voterName" placeholder="„ÅäÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æãÔºöÂ±±Áî∞Â§™ÈÉéÔºâ" required />
                </div>

                <div id="questions-container">
                    <!-- ÂãïÁöÑ„Å´ÂïèÈ°å„ÅåË°®Á§∫„Åï„Çå„Çã -->
                </div>

                <div class="message success" id="successMessage">‚úÖ ÊäïÁ•®„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ</div>

                <div class="message error" id="errorMessage">‚ùå „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ</div>

                <button onclick="submitVote()" id="voteButton">ÊäïÁ•®„Åô„Çã</button>
                <button onclick="showResults()" class="btn-success">ÁµêÊûú„ÇíË¶ã„Çã</button>

                <div class="results" id="results">
                    <h3>üìä ÊäïÁ•®ÁµêÊûú</h3>
                    <div id="resultsList"></div>
                    <p style="color: #666; font-size: 14px; margin-top: 20px">Á∑èÊäïÁ•®Êï∞: <span id="totalVotes">0</span>Á•®</p>
                </div>
            </div>

            <!-- ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ -->
            <div id="admin-mode" class="hidden">
                <div class="admin-login" id="admin-login">
                    <h3>üîê ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥</h3>
                    <input type="password" id="adminPassword" placeholder="ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ" />
                    <button onclick="adminLogin()">„É≠„Ç∞„Ç§„É≥</button>
                </div>

                <div class="admin-panel" id="admin-panel">
                    <h3>üìù ÂïèÈ°åÁÆ°ÁêÜ</h3>

                    <!-- Êñ∞„Åó„ÅÑÂïèÈ°å‰ΩúÊàê -->
                    <div class="question-form">
                        <h4>Êñ∞„Åó„ÅÑÂïèÈ°å„Çí‰ΩúÊàê</h4>
                        <input type="text" id="newQuestionTitle" placeholder="ÂïèÈ°å„Çø„Ç§„Éà„É´" />
                        <textarea id="newQuestionDescription" placeholder="ÂïèÈ°å„ÅÆË™¨ÊòéÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ"></textarea>

                        <div id="options-container">
                            <div class="option-input">
                                <input type="text" placeholder="ÈÅ∏ÊäûËÇ¢1" id="option0" />
                                <input type="radio" name="correctAnswer" value="0" /> Ê≠£Ëß£
                            </div>
                            <div class="option-input">
                                <input type="text" placeholder="ÈÅ∏ÊäûËÇ¢2" id="option1" />
                                <input type="radio" name="correctAnswer" value="1" /> Ê≠£Ëß£
                            </div>
                        </div>

                        <button onclick="addOption()" class="btn-success">ÈÅ∏ÊäûËÇ¢ËøΩÂä†</button>
                        <button onclick="removeOption()" class="btn-danger">ÈÅ∏ÊäûËÇ¢ÂâäÈô§</button>
                        <button onclick="createQuestion()" class="btn-warning">ÂïèÈ°å‰ΩúÊàê</button>
                    </div>

                    <!-- Êó¢Â≠òÂïèÈ°å‰∏ÄË¶ß -->
                    <div class="question-list" id="admin-questions-list">
                        <h4>Êó¢Â≠ò„ÅÆÂïèÈ°å</h4>
                        <!-- ÂãïÁöÑ„Å´ÂïèÈ°å‰∏ÄË¶ß„ÅåË°®Á§∫„Åï„Çå„Çã -->
                    </div>

                    <!-- Áµ±Ë®àÊÉÖÂ†± -->
                    <div id="admin-stats">
                        <h3>üìä Áµ±Ë®àÊÉÖÂ†±</h3>
                        <div class="stats-grid" id="stats-container">
                            <!-- ÂãïÁöÑ„Å´Áµ±Ë®à„ÅåË°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>

                    <button onclick="adminLogout()" class="btn-danger">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
                </div>
            </div>
        </div>

        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

        <script>
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyA0G-ZXD_90Tk698OzmDmDSObURkxgmsEE",
                authDomain: "kekki-c7090.firebaseapp.com",
                databaseURL: "https://kekki-c7090-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "kekki-c7090",
                storageBucket: "kekki-c7090.firebasestorage.app",
                messagingSenderId: "6528604747",
                appId: "1:6528604747:web:d1cd3a5e9d6e70a1e48bce",
                measurementId: "G-S44YVP0G3N",
            };

            // Firebase„ÇíÂàùÊúüÂåñ
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
        </script>

        <script>
            // Firebase„ÅÆ„Éá„Éº„Çø„Éô„Éº„Çπ„ÇíÂèÇÁÖß
            const db = firebase.database();

            // ÂàùÊúü„Éá„Éº„Çø„Å®„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
            const DEFAULT_PASSWORD = "admin123";
            let currentMode = "vote";
            let isAdminLoggedIn = false;
            let optionCount = 2;

            // „Éá„Éº„Çø„Çí‰øùÊåÅ„Åô„Çã„É≠„Éº„Ç´„É´Â§âÊï∞
            let questions = [];
            let voters = [];
            let userVotes = {};

            // --- Firebase„Å®„ÅÆ„Éá„Éº„ÇøÂêåÊúü ---

            // 1. ÂïèÈ°å„Éá„Éº„Çø„ÅÆÂêåÊúü
            db.ref("questions").on("value", (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    questions = data;
                } else {
                    // DB„Å´„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÄÅÂàùÊúü„Éá„Éº„Çø„ÇíÊõ∏„ÅçËæº„ÇÄ
                    const initialQuestions = [
                        {
                            id: 1,
                            title: "„ÅÇ„Å™„Åü„ÅåÊúÄ„ÇÇÂ•Ω„Åç„Å™„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Ë®ÄË™û„ÅØÔºü",
                            description: "",
                            options: ["Python", "JavaScript", "Java", "C++"],
                            correctAnswer: 0,
                            active: true,
                            votes: [0, 0, 0, 0],
                        },
                    ];
                    db.ref("questions").set(initialQuestions);
                }
                // ÁîªÈù¢„ÇíÂÜçÊèèÁîª
                if (currentMode === "vote") renderQuestions();
                if (isAdminLoggedIn) {
                    renderAdminQuestions();
                    renderAdminStats();
                }
            });

            // 2. ÊäïÁ•®ËÄÖ„Éá„Éº„Çø„ÅÆÂêåÊúü
            db.ref("voters").on("value", (snapshot) => {
                voters = snapshot.val() || [];
                if (isAdminLoggedIn) renderAdminStats();
            });

            // 3. „É¶„Éº„Ç∂„Éº„Åî„Å®„ÅÆÊäïÁ•®Ë®òÈå≤„ÅÆÂêåÊúü
            db.ref("userVotes").on("value", (snapshot) => {
                userVotes = snapshot.val() || {};
            });

            // --- „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Çí‰Ωø„Å£„Å¶„ÅÑ„ÅüÈñ¢Êï∞„ÇíFirebase„Çí‰Ωø„ÅÜ„Çà„ÅÜ„Å´Â§âÊõ¥ ---

            function getQuestions() {
                return questions;
            }

            function getVoters() {
                return voters;
            }

            function getVotes() {
                return userVotes;
            }

            function saveQuestions(newQuestions) {
                db.ref("questions").set(newQuestions);
            }

            function saveVoters(newVoters) {
                db.ref("voters").set(newVoters);
            }

            function saveVotes(newUserVotes) {
                db.ref("userVotes").set(newUserVotes);
            }

            // --- ‰ª•‰∏ã„ÄÅÊó¢Â≠ò„ÅÆÈñ¢Êï∞Ôºà„Åª„ÅºÂ§âÊõ¥„Å™„ÅóÔºâ ---

            // „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
            function switchMode(mode) {
                currentMode = mode;
                document.querySelectorAll(".mode-btn").forEach((btn) => btn.classList.remove("active"));
                event.target.classList.add("active");
                if (mode === "vote") {
                    document.getElementById("vote-mode").classList.remove("hidden");
                    document.getElementById("admin-mode").classList.add("hidden");
                    renderQuestions();
                } else {
                    document.getElementById("vote-mode").classList.add("hidden");
                    document.getElementById("admin-mode").classList.remove("hidden");
                    if (!isAdminLoggedIn) {
                        document.getElementById("admin-login").style.display = "block";
                        document.getElementById("admin-panel").style.display = "none";
                    }
                }
            }

            // ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥
            function adminLogin() {
                const password = document.getElementById("adminPassword").value;
                if (password === DEFAULT_PASSWORD) {
                    isAdminLoggedIn = true;
                    document.getElementById("admin-login").style.display = "none";
                    document.getElementById("admin-panel").style.display = "block";
                    renderAdminQuestions();
                    renderAdminStats();
                    showMessage("success", "ÁÆ°ÁêÜËÄÖ„Å®„Åó„Å¶„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„Åü„ÄÇ");
                } else {
                    showMessage("error", "„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ");
                }
            }

            function adminLogout() {
                isAdminLoggedIn = false;
                document.getElementById("admin-login").style.display = "block";
                document.getElementById("admin-panel").style.display = "none";
                document.getElementById("adminPassword").value = "";
            }

            // ÂïèÈ°åË°®Á§∫ÔºàÊäïÁ•®ËÄÖÁî®Ôºâ
            function renderQuestions() {
                const activeQuestions = getQuestions().filter((q) => q && q.active);
                const container = document.getElementById("questions-container");
                container.innerHTML = ""; // ‰ª•Ââç„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çí„ÇØ„É™„Ç¢

                if (activeQuestions.length === 0) {
                    container.innerHTML = "<p>ÁèæÂú®„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>";
                    return;
                }

                activeQuestions.forEach((question) => {
                    const questionDiv = document.createElement("div");
                    questionDiv.className = "question";
                    questionDiv.setAttribute("data-question-id", question.id);

                    const titleElement = document.createElement("h3");
                    titleElement.textContent = question.title;
                    questionDiv.appendChild(titleElement);

                    if (question.description) {
                        const descElement = document.createElement("p");
                        descElement.textContent = question.description;
                        questionDiv.appendChild(descElement);
                    }

                    const optionsDiv = document.createElement("div");
                    optionsDiv.className = "options";
                    question.options.forEach((option, index) => {
                        const label = document.createElement("label");
                        label.className = "option";
                        const radio = document.createElement("input");
                        radio.type = "radio";
                        radio.name = `vote-${question.id}`;
                        radio.value = index;
                        const optionText = document.createTextNode(option);
                        label.appendChild(radio);
                        label.appendChild(optionText);
                        optionsDiv.appendChild(label);
                    });
                    questionDiv.appendChild(optionsDiv);
                    container.appendChild(questionDiv);
                });
            }

            // ÁÆ°ÁêÜËÄÖÁî®ÂïèÈ°å‰∏ÄË¶ß
            function renderAdminQuestions() {
                const allQuestions = getQuestions();
                const container = document.getElementById("admin-questions-list");
                container.innerHTML = "<h4>Êó¢Â≠ò„ÅÆÂïèÈ°å</h4>"; // „ÇØ„É™„Ç¢„Åó„Å¶Ë¶ãÂá∫„Åó„ÇíËøΩÂä†

                allQuestions.forEach((question, index) => {
                    // id„ÅÆ‰ª£„Çè„Çä„Å´index„Çí‰Ωø„ÅÜ
                    if (!question) return; // ÂâäÈô§„Åï„Çå„Åü„Éá„Éº„Çø„ÅØ„Çπ„Ç≠„ÉÉ„Éó

                    const questionItem = document.createElement("div");
                    questionItem.className = `question-item ${question.active ? "active" : "inactive"}`;
                    const title = document.createElement("h5");
                    title.textContent = question.title;
                    questionItem.appendChild(title);

                    const optionsP = document.createElement("p");
                    optionsP.textContent = "ÈÅ∏ÊäûËÇ¢: " + question.options.join(", ");
                    questionItem.appendChild(optionsP);

                    const correctP = document.createElement("p");
                    correctP.textContent = `Ê≠£Ëß£: ${question.options[question.correctAnswer]} (${question.correctAnswer + 1}Áï™ÁõÆ)`;
                    questionItem.appendChild(correctP);

                    const totalVotes = question.votes ? question.votes.reduce((a, b) => a + b, 0) : 0;
                    const votesP = document.createElement("p");
                    votesP.textContent = `ÊäïÁ•®Êï∞: ${totalVotes}Á•®`;
                    questionItem.appendChild(votesP);

                    const statusP = document.createElement("p");
                    statusP.textContent = `Áä∂ÊÖã: ${question.active ? "„Ç¢„ÇØ„ÉÜ„Ç£„Éñ" : "Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ"}`;
                    questionItem.appendChild(statusP);

                    const toggleBtn = document.createElement("button");
                    toggleBtn.textContent = question.active ? "ÁÑ°ÂäπÂåñ" : "ÊúâÂäπÂåñ";
                    toggleBtn.className = question.active ? "btn-danger" : "btn-success";
                    toggleBtn.onclick = () => toggleQuestion(question.id);
                    questionItem.appendChild(toggleBtn);

                    const deleteBtn = document.createElement("button");
                    deleteBtn.textContent = "ÂâäÈô§";
                    deleteBtn.className = "btn-danger";
                    deleteBtn.onclick = () => deleteQuestion(question.id);
                    questionItem.appendChild(deleteBtn);

                    container.appendChild(questionItem);
                });
            }

            // Áµ±Ë®àÊÉÖÂ†±Ë°®Á§∫
            function renderAdminStats() {
                const allQuestions = getQuestions();
                const allVoters = getVoters();

                let totalVotes = 0;
                let correctAnswers = 0;
                let questionStats = [];

                allQuestions.forEach((question) => {
                    if (!question) return;
                    const questionVotes = question.votes ? question.votes.reduce((a, b) => a + b, 0) : 0;
                    totalVotes += questionVotes;

                    const correctVotes = question.votes ? question.votes[question.correctAnswer] : 0;
                    correctAnswers += correctVotes;

                    const accuracy = questionVotes > 0 ? ((correctVotes / questionVotes) * 100).toFixed(1) : 0;

                    questionStats.push({
                        title: question.title,
                        totalVotes: questionVotes,
                        correctVotes: correctVotes,
                        accuracy: accuracy,
                    });
                });

                const overallAccuracy = totalVotes > 0 ? ((correctAnswers / totalVotes) * 100).toFixed(1) : 0;

                const container = document.getElementById("stats-container");
                container.innerHTML = ""; // „ÇØ„É™„Ç¢

                const createStatCard = (title, number, description) => {
                    const card = document.createElement("div");
                    card.className = "stat-card";
                    const h5 = document.createElement("h5");
                    h5.textContent = title;
                    card.appendChild(h5);
                    const statNumber = document.createElement("div");
                    statNumber.className = "stat-number";
                    statNumber.textContent = number;
                    card.appendChild(statNumber);
                    const p = document.createElement("p");
                    p.textContent = description;
                    card.appendChild(p);
                    return card;
                };

                container.appendChild(createStatCard("ÂÖ®‰ΩìÁµ±Ë®à", totalVotes, "Á∑èÊäïÁ•®Êï∞"));
                container.appendChild(createStatCard("ÁôªÈå≤ËÄÖÊï∞", allVoters.length, "ÊäïÁ•®ËÄÖ"));
                container.appendChild(createStatCard("ÂÖ®‰ΩìÊ≠£Á≠îÁéá", `${overallAccuracy}%`, "Ê≠£Ëß£Áéá"));
                container.appendChild(createStatCard("ÂïèÈ°åÊï∞", allQuestions.filter((q) => q).length, "‰ΩúÊàêÊ∏à„ÅøÂïèÈ°å"));

                questionStats.forEach((stat) => {
                    const card = document.createElement("div");
                    card.className = "stat-card";
                    const h5 = document.createElement("h5");
                    h5.textContent = stat.title;
                    card.appendChild(h5);
                    const statNumber = document.createElement("div");
                    statNumber.className = "stat-number";
                    statNumber.textContent = `${stat.accuracy}%`;
                    card.appendChild(statNumber);
                    const p = document.createElement("p");
                    p.textContent = `Ê≠£Á≠îÁéá (${stat.correctVotes}/${stat.totalVotes})`;
                    card.appendChild(p);
                    container.appendChild(card);
                });
            }

            // ÈÅ∏ÊäûËÇ¢ËøΩÂä†„ÉªÂâäÈô§
            function addOption() {
                optionCount++;
                const container = document.getElementById("options-container");
                const newOption = document.createElement("div");
                newOption.className = "option-input";
                const textInput = document.createElement("input");
                textInput.type = "text";
                textInput.placeholder = `ÈÅ∏ÊäûËÇ¢${optionCount}`;
                textInput.id = `option${optionCount - 1}`;
                const radioInput = document.createElement("input");
                radioInput.type = "radio";
                radioInput.name = "correctAnswer";
                radioInput.value = optionCount - 1;
                const labelText = document.createTextNode(" Ê≠£Ëß£");
                newOption.appendChild(textInput);
                newOption.appendChild(radioInput);
                newOption.appendChild(labelText);
                container.appendChild(newOption);
            }

            function removeOption() {
                if (optionCount > 2) {
                    const container = document.getElementById("options-container");
                    container.removeChild(container.lastElementChild);
                    optionCount--;
                }
            }

            // ÂïèÈ°å‰ΩúÊàê
            function createQuestion() {
                const title = document.getElementById("newQuestionTitle").value.trim();
                if (!title) return showMessage("error", "ÂïèÈ°å„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");

                const options = [];
                for (let i = 0; i < optionCount; i++) {
                    const optionValue = document.getElementById(`option${i}`).value.trim();
                    if (!optionValue) return showMessage("error", `ÈÅ∏ÊäûËÇ¢${i + 1}„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);
                    options.push(optionValue);
                }

                const correctRadio = document.querySelector('input[name="correctAnswer"]:checked');
                if (!correctRadio) return showMessage("error", "Ê≠£Ëß£„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");

                const allQuestions = getQuestions();
                const newQuestion = {
                    id: allQuestions.length > 0 ? Math.max(...allQuestions.map((q) => q.id)) + 1 : 1,
                    title: title,
                    description: document.getElementById("newQuestionDescription").value.trim(),
                    options: options,
                    correctAnswer: parseInt(correctRadio.value),
                    active: true,
                    votes: new Array(options.length).fill(0),
                };

                allQuestions.push(newQuestion);
                saveQuestions(allQuestions);

                // „Éï„Ç©„Éº„É†„É™„Çª„ÉÉ„Éà
                document.getElementById("newQuestionTitle").value = "";
                document.getElementById("newQuestionDescription").value = "";
                for (let i = 0; i < optionCount; i++) document.getElementById(`option${i}`).value = "";
                correctRadio.checked = false;

                showMessage("success", "Êñ∞„Åó„ÅÑÂïèÈ°å„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü„ÄÇ");
            }

            // ÂïèÈ°å„ÅÆÊúâÂäπÂåñ„ÉªÁÑ°ÂäπÂåñ
            function toggleQuestion(questionId) {
                const allQuestions = getQuestions();
                const question = allQuestions.find((q) => q && q.id === questionId);
                if (question) {
                    question.active = !question.active;
                    saveQuestions(allQuestions);
                }
            }

            // ÂïèÈ°åÂâäÈô§
            function deleteQuestion(questionId) {
                if (confirm("„Åì„ÅÆÂïèÈ°å„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) {
                    let allQuestions = getQuestions();
                    // Firebase„Åß„ÅØÈÖçÂàó„ÅÆË¶ÅÁ¥†„ÇíÁõ¥Êé•ÂâäÈô§„Åô„Çã„Çà„Çä„ÄÅnull„Åß‰∏äÊõ∏„Åç„Åô„Çã„ÅÆ„ÅåÁ∞°Âçò
                    const questionIndex = allQuestions.findIndex((q) => q && q.id === questionId);
                    if (questionIndex !== -1) {
                        allQuestions[questionIndex] = null;
                    }
                    saveQuestions(allQuestions);
                }
            }

            // ÊäïÁ•®Âá¶ÁêÜ
            function submitVote() {
                const voterName = document.getElementById("voterName").value.trim();
                if (!voterName) return showMessage("error", "„ÅäÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");

                const allVoters = getVoters();
                if (allVoters.includes(voterName)) return showMessage("error", "„Åì„ÅÆ„ÅäÂêçÂâç„ÅØÊó¢„Å´ÊäïÁ•®Ê∏à„Åø„Åß„Åô„ÄÇ");

                const activeQuestions = getQuestions().filter((q) => q && q.active);
                const currentUserVotes = getVotes();
                const allQuestions = getQuestions();

                let hasVoted = false;
                activeQuestions.forEach((question) => {
                    const selectedOption = document.querySelector(`input[name="vote-${question.id}"]:checked`);
                    if (selectedOption) {
                        const optionIndex = parseInt(selectedOption.value);
                        const questionInAll = allQuestions.find((q) => q && q.id === question.id);
                        if (!questionInAll.votes) {
                            // Âøµ„ÅÆ„Åü„ÇÅÂàùÊúüÂåñ
                            questionInAll.votes = new Array(questionInAll.options.length).fill(0);
                        }
                        questionInAll.votes[optionIndex]++;

                        if (!currentUserVotes[voterName]) currentUserVotes[voterName] = {};
                        currentUserVotes[voterName][question.id] = optionIndex;
                        hasVoted = true;
                    }
                });

                if (!hasVoted) return showMessage("error", "Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆÂïèÈ°å„Å´ÂõûÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");

                saveQuestions(allQuestions);
                saveVotes(currentUserVotes);
                allVoters.push(voterName);
                saveVoters(allVoters);

                showMessage("success", "ÊäïÁ•®„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ");
                document.getElementById("voteButton").disabled = true;
                document.getElementById("voterName").disabled = true;
                document.querySelectorAll('input[type="radio"]').forEach((input) => (input.disabled = true));

                setTimeout(() => showResults(), 1500);
            }

            // ÁµêÊûúË°®Á§∫
            function showResults() {
                const activeQuestions = getQuestions().filter((q) => q && q.active);
                const resultsDiv = document.getElementById("results");
                const resultsListDiv = document.getElementById("resultsList");

                if (activeQuestions.length === 0) return showMessage("error", "„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ");

                let totalVotes = 0;
                resultsListDiv.innerHTML = "";

                activeQuestions.forEach((question) => {
                    const questionTotalVotes = question.votes ? question.votes.reduce((sum, count) => sum + count, 0) : 0;
                    totalVotes += questionTotalVotes;

                    const questionTitle = document.createElement("h4");
                    questionTitle.textContent = question.title;
                    resultsListDiv.appendChild(questionTitle);

                    question.options.forEach((option, index) => {
                        const count = question.votes ? question.votes[index] : 0;
                        const percentage = questionTotalVotes > 0 ? ((count / questionTotalVotes) * 100).toFixed(1) : 0;

                        const resultItem = document.createElement("div");
                        resultItem.className = "result-item";

                        const optionSpan = document.createElement("span");
                        const strongEl = document.createElement("strong");
                        strongEl.textContent = option;
                        optionSpan.appendChild(strongEl);

                        const countSpan = document.createElement("span");
                        countSpan.textContent = `${count}Á•® (${percentage}%)`;

                        resultItem.appendChild(optionSpan);
                        resultItem.appendChild(countSpan);

                        const resultBar = document.createElement("div");
                        resultBar.className = "result-bar";
                        resultBar.style.width = `${percentage}%`;

                        resultsListDiv.appendChild(resultItem);
                        resultsListDiv.appendChild(resultBar);
                    });
                });

                document.getElementById("totalVotes").textContent = totalVotes;
                resultsDiv.style.display = "block";
            }

            // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
            function showMessage(type, message) {
                document.getElementById("successMessage").style.display = "none";
                document.getElementById("errorMessage").style.display = "none";

                const messageElement = document.getElementById(type + "Message");
                messageElement.textContent = (type === "success" ? "‚úÖ " : "‚ùå ") + message;
                messageElement.style.display = "block";

                setTimeout(() => {
                    messageElement.style.display = "none";
                }, 3000);
            }

            // ÂàùÊúüÂåñ
            window.onload = function () {
                // Firebase„ÅÆon()„ÅåËá™Âãï„ÅßÊèèÁîª„Åô„Çã„ÅÆ„Åß„ÄÅ„Åì„Åì„Åß„ÅÆÂëº„Å≥Âá∫„Åó„ÅØ‰∏çË¶Å„Å´„Å™„Çã„Åì„Å®„ÅåÂ§ö„ÅÑ
                // „ÇÇ„ÅóÂàùÊúüË°®Á§∫„Åå„ÅÜ„Åæ„Åè„ÅÑ„Åã„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆË°å„ÅÆ„Ç≥„É°„É≥„Éà„ÇíÂ§ñ„Åô
                // renderQuestions();
            };
        </script>
    </body>
</html>
